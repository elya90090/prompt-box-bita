<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ادمین جعبه پرامپت بیتا</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.10.0/dist/supabase.min.js"></script>
<style>
body { font-family: Arial, sans-serif; background:#f4f4f4; padding:20px; }
.container { max-width:600px; margin:auto; }
h2 { text-align:center; margin-bottom:20px; }
footer { text-align:center; margin-top:30px; }
</style>
</head>
<body>

<div class="container">
  <h2>ورود ادمین</h2>
  <input type="text" id="username" class="form-control mb-2" placeholder="نام کاربری">
  <input type="password" id="password" class="form-control mb-2" placeholder="رمز عبور">
  <button class="btn btn-primary w-100 mb-3" onclick="login()">ورود</button>

  <div id="adminPanel" style="display:none;">
    <h3>ثبت پرامپت جدید</h3>
    <input type="text" id="name" class="form-control mb-2" placeholder="نام پرامپت">
    <textarea id="text" class="form-control mb-2" placeholder="متن پرامپت"></textarea>
    <input type="text" id="source" class="form-control mb-2" placeholder="منبع">
    <input type="text" id="category" class="form-control mb-2" placeholder="دسته بندی">
    <input type="text" id="description" class="form-control mb-2" placeholder="شرح">
    <button class="btn btn-success w-100" onclick="addPrompt()">ثبت</button>
  </div>
</div>

<footer>
  طراحی و توسعه دهنده @raz3400
</footer>

<script>
// اتصال به Supabase
const supabaseUrl = 'YOUR_SUPABASE_URL';             // ← آدرس پروژه‌ات در Supabase
const supabaseKey = 'YOUR_SUPABASE_ANON_KEY';        // ← کلید anon پروژه‌ات
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

// اطلاعات ربات تلگرام
const TELEGRAM_BOT_TOKEN = 'YOUR_TELEGRAM_BOT_TOKEN';  // ← توکن ربات
const TELEGRAM_CHAT_ID = 'YOUR_SUPERGROUP_CHAT_ID';    // ← آیدی سوپرگروه (مثال: -100123456789)
const TELEGRAM_TOPIC_ID = 'YOUR_TOPIC_ID';             // ← آیدی تاپیک (مثال: 34547)

// ورود ادمین
async function login(){
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();

  const { data, error } = await supabase
    .from('admins')
    .select('*')
    .eq('username', username)
    .eq('password', password);

  if(error || !data || data.length === 0){
    alert('نام کاربری یا رمز عبور اشتباه است ❌');
    return;
  }

  document.getElementById('adminPanel').style.display = 'block';
  alert('ورود موفق ✅');
}

// افزودن پرامپت
async function addPrompt(){
  const name = document.getElementById('name').value;
  const text = document.getElementById('text').value;
  const source = document.getElementById('source').value;
  const category = document.getElementById('category').value;
  const description = document.getElementById('description').value;

  const date = new Date();
  const iranOffset = 4.5 * 60;
  const localDate = new Date(date.getTime() + iranOffset*60000);
  const dateShamsi = localDate.toLocaleDateString('fa-IR');
  const time = localDate.toLocaleTimeString('fa-IR');
  const trackingCode = 'P' + Date.now();

  const { error } = await supabase.from('prompts').insert([{
    name, text, source, category, description, dateShamsi, time, trackingCode
  }]);

  if(error){ 
    alert('خطا در ثبت: ' + error.message); 
    return; 
  }

  const message = `📝 پرامپت جدید ثبت شد\n\n` +
  `📌 نام پرامپت: ${name}\n` +
  `💬 متن پرامپت: ${text}\n` +
  `🔗 منبع: ${source}\n` +
  `📂 دسته بندی: ${category}\n` +
  `📝 شرح: ${description}\n` +
  `📅 تاریخ ثبت: ${dateShamsi}\n` +
  `⏰ ساعت ثبت: ${time}\n` +
  `🔑 کد رهگیری: ${trackingCode}`;

  // ارسال پیام به سوپرگروه + تاپیک
  fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      chat_id: TELEGRAM_CHAT_ID,
      message_thread_id: TELEGRAM_TOPIC_ID,
      text: message
    })
  })
    .then(() => alert('ثبت شد و پیام به سوپرگروه ارسال شد ✅'))
    .catch(err => alert('پیام تلگرام ارسال نشد: ' + err));

  // پاک کردن فرم
  document.getElementById('name').value = '';
  document.getElementById('text').value = '';
  document.getElementById('source').value = '';
  document.getElementById('category').value = '';
  document.getElementById('description').value = '';
}
</script>

</body>
</html>
