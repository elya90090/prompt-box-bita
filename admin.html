<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ø¯Ù…ÛŒÙ† Ø¬Ø¹Ø¨Ù‡ Ù¾Ø±Ø§Ù…Ù¾Øª Ø¨ÛŒØªØ§</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { font-family: Arial, sans-serif; background:#f4f4f4; }
.admin-section { max-width:900px; margin:2rem auto; padding:1rem; background:white; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
textarea { resize:none; }
table th, table td { text-align:center; }
</style>
</head>
<body>

<div class="admin-section">
  <h3>Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†</h3>

  <!-- ÙˆØ±ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ† -->
  <div id="adminLogin">
    <input type="text" id="adminUsername" class="form-control mb-2" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø§Ø¯Ù…ÛŒÙ†">
    <input type="password" id="adminPassword" class="form-control mb-2" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø¯Ù…ÛŒÙ†">
    <button class="btn btn-primary w-100" onclick="adminLogin()">ÙˆØ±ÙˆØ¯</button>
  </div>

  <!-- Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ† -->
  <div id="adminPanel" style="display:none;">
    <h5 class="mt-3">Ø§Ø¶Ø§ÙÙ‡ / ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ø±Ø§Ù…Ù¾Øª</h5>

    <div class="row g-2 mb-2">
      <div class="col-md-6">
        <input type="number" id="promptId" class="form-control mb-2" placeholder="Ø¨Ø±Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ØŒ Ø´Ù…Ø§Ø±Ù‡ Ø±Ø¯ÛŒÙ (ID)">
        <input type="text" id="promptName" class="form-control mb-2" placeholder="Ù†Ø§Ù… Ù¾Ø±Ø§Ù…Ù¾Øª">
        <textarea id="promptText" class="form-control mb-2" placeholder="Ù…ØªÙ† Ù¾Ø±Ø§Ù…Ù¾Øª"></textarea>
        <input type="text" id="promptSource" class="form-control mb-2" placeholder="Ù…Ù†Ø¨Ø¹">
      </div>
      <div class="col-md-6">
        <input type="text" id="promptOwner" class="form-control mb-2" placeholder="Ù†Ø§Ù…">
        <textarea id="promptDescription" class="form-control mb-2" placeholder="Ø´Ø±Ø­ (HTML Ù…Ø¬Ø§Ø²)"></textarea>
        <select id="promptCategory" class="form-select mb-2">
          <option value="Ø¯Ø³ØªÙ‡1">Ø¯Ø³ØªÙ‡1</option>
          <option value="Ø¯Ø³ØªÙ‡2">Ø¯Ø³ØªÙ‡2</option>
          <option value="Ø¯Ø³ØªÙ‡3">Ø¯Ø³ØªÙ‡3</option>
        </select>
        <button class="btn btn-success w-100 mb-2" onclick="addOrUpdatePrompt()">Ø«Ø¨Øª / ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ø±Ø§Ù…Ù¾Øª</button>
      </div>
    </div>

    <h5 class="mt-4">Ù„ÛŒØ³Øª Ù¾Ø±Ø§Ù…Ù¾Øªâ€ŒÙ‡Ø§</h5>
    <div class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead class="table-primary">
          <tr>
            <th>ID</th>
            <th>Ù†Ø§Ù… Ù¾Ø±Ø§Ù…Ù¾Øª</th>
            <th>Ù…ØªÙ† Ù¾Ø±Ø§Ù…Ù¾Øª</th>
            <th>Ù…Ù†Ø¨Ø¹</th>
            <th>Ù†Ø§Ù…</th>
            <th>Ø´Ø±Ø­</th>
            <th>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</th>
          </tr>
        </thead>
        <tbody id="promptTable"></tbody>
      </table>
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.10.0/dist/supabase.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jalaali-js@1.1.0/dist/jalaali.min.js"></script>

<script>
const supabaseUrl = 'https://YOUR_PROJECT_ID.supabase.co';
const supabaseKey = 'YOUR_ANON_KEY';
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

// ÙˆØ±ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ†
const adminUsername = "bitaadmin";
const adminPassword = "123456";

function adminLogin(){
  const username = document.getElementById('adminUsername').value;
  const password = document.getElementById('adminPassword').value;
  if(username === adminUsername && password === adminPassword){
    document.getElementById('adminLogin').style.display = 'none';
    document.getElementById('adminPanel').style.display = 'block';
    loadPrompts();
  } else {
    alert("Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª");
  }
}

// Ø²Ù…Ø§Ù† Ø§ÛŒØ±Ø§Ù† Ùˆ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ
function getIranTime(){
  const now = new Date();
  const offset = 3.5*60; // GMT+3:30
  return new Date(now.getTime() + (offset - now.getTimezoneOffset())*60000);
}
function getShamsiDate(){
  const now = getIranTime();
  const j = jalaali.toJalaali(now);
  return `${j.jy}/${j.jm}/${j.jd}`;
}
function getTrackingCode(){
  return Math.random().toString(36).substring(2,10).toUpperCase();
}

// Ù¾ÛŒØ§Ù… ØªÙ„Ú¯Ø±Ø§Ù…
async function sendTelegramNotification(prompt){
  const botToken = "YOUR_BOT_TOKEN";
  const chatId = "YOUR_SUPERGROUP_CHAT_ID";

  const message = `
ğŸ“Œ Ù¾Ø±Ø§Ù…Ù¾Øª Ø«Ø¨Øª / ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯!
ğŸ“ Ù†Ø§Ù… Ù¾Ø±Ø§Ù…Ù¾Øª: ${prompt.name}
ğŸ’¬ Ù…ØªÙ†: ${prompt.text}
ğŸŒ Ù…Ù†Ø¨Ø¹: ${prompt.source}
ğŸ‘¤ Ù†Ø§Ù…: ${prompt.owner}
ğŸ“ Ø´Ø±Ø­: ${prompt.description}
ğŸ“‚ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ: ${prompt.category}
ğŸ—“ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ: ${prompt.date_shamsi}
â° Ø³Ø§Ø¹Øª Ø§ÛŒØ±Ø§Ù†: ${prompt.time_iran}
ğŸ†” Ú©Ø¯ Ø±Ù‡Ú¯ÛŒØ±ÛŒ: ${prompt.tracking_code}
`;
  await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({chat_id: chatId,text: message,parse_mode:"HTML"})
  });
}

// Ø§ÙØ²ÙˆØ¯Ù† ÛŒØ§ ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ø±Ø§Ù…Ù¾Øª
async function addOrUpdatePrompt(){
  const id = document.getElementById('promptId').value;
  const name = document.getElementById('promptName').value;
  const text = document.getElementById('promptText').value;
  const source = document.getElementById('promptSource').value;
  const owner = document.getElementById('promptOwner').value;
  const description = document.getElementById('promptDescription').value;
  const category = document.getElementById('promptCategory').value;

  const date_shamsi = getShamsiDate();
  const time_iran = getIranTime().toLocaleTimeString('fa-IR');
  const tracking_code = getTrackingCode();

  if(id){ // ÙˆÛŒØ±Ø§ÛŒØ´
    const { error } = await supabase.from('prompts').update({
      name,text,source,owner,description,category,date_shamsi,time_iran,tracking_code
    }).eq('id', id);
    if(!error){
      sendTelegramNotification({name,text,source,owner,description,category,date_shamsi,time_iran,tracking_code});
      alert("ÙˆÛŒØ±Ø§ÛŒØ´ Ù…ÙˆÙÙ‚ âœ…");
      loadPrompts();
    }
  } else { // Ø§ÙØ²ÙˆØ¯Ù†
    const { error } = await supabase.from('prompts').insert([{
      name,text,source,owner,description,category,date_shamsi,time_iran,tracking_code
    }]);
    if(!error){
      sendTelegramNotification({name,text,source,owner,description,category,date_shamsi,time_iran,tracking_code});
      alert("Ø«Ø¨Øª Ù…ÙˆÙÙ‚ âœ…");
      loadPrompts();
    }
  }
}

// Ù†Ù…Ø§ÛŒØ´ Ù¾Ø±Ø§Ù…Ù¾Øªâ€ŒÙ‡Ø§ Ø¯Ø± Ø¬Ø¯ÙˆÙ„
async function loadPrompts(){
  const { data, error } = await supabase.from('prompts').select('*').order('id');
  if(error){ console.error(error); return; }
  const tbody = document.getElementById('promptTable');
  tbody.innerHTML = '';
  data.forEach(r=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${r.id}</td>
      <td>${r.name}</td>
      <td>${r.text}</td>
      <td>${r.source}</td>
      <td>${r.owner}</td>
      <td>${r.description}</td>
      <td>${r.category}</td>
    `;
    tbody.appendChild(tr);
  });
}
</script>

</body>
</html>
